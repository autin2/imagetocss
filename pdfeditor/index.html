<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Image to CSS — AI palettes & utility classes from any image</title>
  <meta name="description" content="Upload an image, get production-ready CSS: color variables, utilities, and component tokens. Private by default, runs in your browser. Accounts & Pro features available."/>
  <link rel="stylesheet" href="style.css"/>
  <meta name="theme-color" content="#0f172a"/>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container nav">
      <a href="/" class="brand">
        <span class="brand-mark" aria-hidden="true"></span>
        <b>Image&nbsp;to&nbsp;CSS</b>
      </a>
      <nav class="links" aria-label="Primary">
        <!-- Centered cluster -->
        <div class="nav-center">
          <a href="pricing.html">Pricing</a>
          <a href="app.html" class="btn small primary">Try it out</a>
        </div>
        <!-- Right auth slot -->
        <div class="nav-auth">
          <button class="btn small ghost js-open-auth" type="button">Sign in</button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Hero (only section) -->
  <main class="hero">
    <div class="container grid-2">
      <div>
        <span class="kicker"><span class="k-dot" aria-hidden="true"></span> AI-powered, privacy-friendly</span>
        <h1>Turn any image of a page into css code. In seconds.</h1>
        <p class="lead">Drop a photo or screenshot. We extract a clean palette, generate CSS variables & utility classes, and preview components. Create an account to save palettes; Pro unlocks batch & brand tokens.</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a href="app.html" class="btn accent">Try it out</a>
          <!-- Modal trigger -->
          <button class="btn js-open-auth" type="button">Sign in</button>
        </div>
      </div>

      <!-- Right: demo -->
      <aside>
        <div class="hero-visual card pad">
          <div class="snip-frame" style="margin-bottom:12px">
            <div class="demo-card token-card" role="region" aria-label="Token-styled component">
              <div class="demo-avatar">T</div>
              <div>
                <p class="demo-title">Test</p>
                <p class="demo-sub">Test</p>
                <div class="demo-tags">
                  <span class="demo-tag">.bg-1</span>
                  <span class="demo-tag">.text-2</span>
                  <span class="demo-tag">.btn-3</span>
                </div>
              </div>
              <div class="demo-cta">
                <button class="btn">Try</button>
              </div>
            </div>
          </div>

          <pre class="code" id="exampleCode" aria-live="off">/* Generating… */</pre>
        </div>
      </aside>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;height:100%">
      <span>© <span id="y">2025</span> Image to CSS</span>
      <span style="color:var(--muted)">Private by default</span>
    </div>
  </footer>

  <!-- ===================== -->
  <!-- Auth Modal (Sign in)  -->
  <!-- ===================== -->
  <div class="modal" id="authModal" aria-hidden="true">
    <div class="modal__scrim" data-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="authTitle" aria-describedby="authDesc">
      <button class="modal__close" type="button" aria-label="Close" title="Close" data-close>×</button>

      <div class="modal__header">
        <h2 id="authTitle">Welcome back</h2>
        <p id="authDesc" class="modal__desc">Sign in to save palettes and access Pro features.</p>
      </div>

      <!-- Tabs: Sign in / Create account -->
      <div class="modal__tabs" role="tablist" aria-label="Authentication">
        <button class="tab is-active" role="tab" aria-selected="true" aria-controls="panel-signin" id="tab-signin">Sign in</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="panel-signup" id="tab-signup">Create account</button>
      </div>

      <div class="modal__content">
        <!-- Sign in panel -->
        <section id="panel-signin" role="tabpanel" aria-labelledby="tab-signin">
          <form class="form" id="formSignIn">
            <label class="label" for="si-email">Email</label>
            <input class="input" id="si-email" type="email" required autocomplete="email" placeholder="you@example.com"/>

            <div class="row">
              <div style="flex:1">
                <label class="label" for="si-pass">Password</label>
                <input class="input" id="si-pass" type="password" required autocomplete="current-password" placeholder="••••••••"/>
              </div>
              <div class="row-end">
                <a href="#" class="link">Forgot?</a>
              </div>
            </div>

            <button class="btn primary block" type="submit">Sign in</button>

            <div class="or"><span>or</span></div>

            <button class="btn google block" type="button" id="googleSignIn">
              <svg aria-hidden="true" width="18" height="18" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.6 20.5H42v-.1H24v7.2h11.3C33.7 32.3 29.3 35 24 35c-7.2 0-13-5.8-13-13S16.8 9 24 9c3.3 0 6.3 1.2 8.6 3.2l5.1-5.1C34.7 3.2 29.6 1 24 1 14.2 1 5.9 6 1.7 14.1l4.6 3.6z"/><path fill="#FF3D00" d="M6.3 14.7l5.9 4.3C13.6 15.7 18.4 13 24 13c3.3 0 6.3 1.2 8.6 3.2l5.1-5.1C34.7 3.2 29.6 1 24 1 14.2 1 5.9 6 1.7 14.1l4.6 3.6z"/><path fill="#4CAF50" d="M24 45c5.2 0 10-1.8 13.7-4.9l-6.3-5c-2 1.3-4.6 2-7.4 2-5.3 0-9.7-2.7-11.3-6.5l-6.3 4.9C9.6 41.7 16.3 45 24 45z"/><path fill="#1976D2" d="M43.6 20.5H42v-.1H24v7.2h11.3C34.7 32.3 29.3 35 24 35c-7.2 0-13-5.8-13-13S16.8 9 24 9c3.3 0 6.3 1.2 8.6 3.2l5.1-5.1C34.7 3.2 29.6 1 24 1 14.2 1 5.9 6 1.7 14.1l4.6 3.6z"/></svg>
              Continue with Google
            </button>
            <p id="si-error" class="hint" style="color:#b91c1c;display:none;margin:8px 0 0"></p>
          </form>
        </section>

        <!-- Sign up panel -->
        <section id="panel-signup" role="tabpanel" aria-labelledby="tab-signup" hidden>
          <form class="form" id="formSignUp">
            <label class="label" for="su-name">Name</label>
            <input class="input" id="su-name" type="text" autocomplete="name" placeholder="Your name"/>

            <label class="label" for="su-email">Email</label>
            <input class="input" id="su-email" type="email" required autocomplete="email" placeholder="you@example.com"/>

            <label class="label" for="su-pass">Password</label>
            <input class="input" id="su-pass" type="password" required autocomplete="new-password" placeholder="Create a password"/>

            <button class="btn primary block" type="submit">Create account</button>

            <div class="or"><span>or</span></div>

            <button class="btn google block" type="button" id="googleSignUp">
              <svg aria-hidden="true" width="18" height="18" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.6 20.5H42v-.1H24v7.2h11.3C33.7 32.3 29.3 35 24 35c-7.2 0-13-5.8-13-13S16.8 9 24 9c3.3 0 6.3 1.2 8.6 3.2l5.1-5.1C34.7 3.2 29.6 1 24 1 14.2 1 5.9 6 1.7 14.1l4.6 3.6z"/><path fill="#FF3D00" d="M6.3 14.7l5.9 4.3C13.6 15.7 18.4 13 24 13c3.3 0 6.3 1.2 8.6 3.2l5.1-5.1C34.7 3.2 29.6 1 24 1 14.2 1 5.9 6 1.7 14.1l4.6 3.6z"/><path fill="#4CAF50" d="M24 45c5.2 0 10-1.8 13.7-4.9l-6.3-5c-2 1.3-4.6 2-7.4 2-5.3 0-9.7-2.7-11.3-6.5l-6.3 4.9C9.6 41.7 16.3 45 24 45z"/><path fill="#1976D2" d="M43.6 20.5H42v-.1H24v7.2h11.3C34.7 32.3 29.3 35 24 35c-7.2 0-13-5.8-13-13S16.8 9 24 9c3.3 0 6.3 1.2 8.6 3.2l5.1-5.1C34.7 3.2 29.6 1 24 1 14.2 1 5.9 6 1.7 14.1l4.6 3.6z"/></svg>
              Continue with Google
            </button>
            <p id="su-error" class="hint" style="color:#b91c1c;display:none;margin:8px 0 0"></p>
          </form>
        </section>
      </div>
    </div>
  </div>

  <script>
    // Year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Typewriter (unchanged)
    const codeEl = document.getElementById('exampleCode');
    const snippet =
`/* Example output */
:root{
  --color-1:#0ea5e9;
  --color-2:#111827;
  --color-3:#f59e0b;
  --color-4:#22c55e;
  --ink:#0f172a;
  --paper:#ffffff;
}
/* Utilities generated from your image */
.bg-1{ background:var(--color-1); }
.text-2{ color:var(--color-2); }
.border-3{ border-color:var(--color-3); }
.btn-4{
  background:var(--color-4);
  color:#05212c;
  border:1px solid var(--color-4);
  padding:10px 14px;
  border-radius:10px;
}
/* Optional component tokens */
.token-card{
  --card-bg: var(--paper);
  --card-ink: var(--ink);
  --card-accent: var(--color-1);
}`;
    const prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReduce) {
      codeEl.textContent = snippet;
    } else {
      const SPEED = 45, PAUSE = 2500; let i = 0, timer = null, running = true;
      function schedule(d){ timer = setTimeout(tick, d); }
      function clearTimer(){ if (timer) { clearTimeout(timer); timer = null; } }
      function tick(){
        if (!running) return;
        codeEl.textContent = snippet.slice(0, i++);
        if (i <= snippet.length) schedule(SPEED);
        else setTimeout(() => { if (!running) return; i = 0; codeEl.textContent = ''; schedule(SPEED); }, PAUSE);
      }
      document.addEventListener('visibilitychange', () => { if (document.hidden){ running=false; clearTimer(); } else { if(!running){ running=true; schedule(SPEED); } } });
      schedule(SPEED);
    }
  </script>

  <!-- =============== -->
  <!-- Supabase Auth   -->
  <!-- =============== -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script>
    // ---- Init (public anon key is safe in browser) ----
    const SUPABASE_URL = "https://vsdmfjkhehtagsrvxbav.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzZG1mamtoZWh0YWdzcnZ4YmF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTA1NjksImV4cCI6MjA3MzM2NjU2OX0.Xd1VhsuOhJF1iEDaw1JApJ5JigJTODypjogm3hdrXxA";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true }
    });

    // ---- Modal wiring ----
    const modal = document.getElementById('authModal');
    const openers = document.querySelectorAll('.js-open-auth');
    const scrim = modal.querySelector('.modal__scrim');
    const closeBtns = modal.querySelectorAll('[data-close]');
    const tabSignin = document.getElementById('tab-signin');
    const tabSignup = document.getElementById('tab-signup');
    const panelSignin = document.getElementById('panel-signin');
    const panelSignup = document.getElementById('panel-signup');

    let lastFocus = null;
    function activateTab(which) {
      const isSignIn = which === 'signin';
      tabSignin.classList.toggle('is-active', isSignIn);
      tabSignup.classList.toggle('is-active', !isSignIn);
      tabSignin.setAttribute('aria-selected', String(isSignIn));
      tabSignup.setAttribute('aria-selected', String(!isSignIn));
      panelSignin.hidden = !isSignIn;
      panelSignup.hidden = isSignIn;
      (isSignIn ? tabSignin : tabSignup).focus();
    }
    function openModal() {
      lastFocus = document.activeElement;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
      activateTab('signin');
      setTimeout(() => document.getElementById('si-email')?.focus(), 10);
      trapFocus(true);
    }
    function closeModal() {
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      trapFocus(false);
      lastFocus?.focus();
    }
    function trapFocus(on) {
      if (!on) { document.removeEventListener('keydown', onKeyDown); return; }
      document.addEventListener('keydown', onKeyDown);
      function onKeyDown(e){
        if (e.key === 'Escape') return closeModal();
        if (e.key !== 'Tab') return;
        const focusables = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        const list = Array.from(focusables).filter(el => !el.hasAttribute('disabled') && el.offsetParent !== null);
        if (!list.length) return;
        const first = list[0], last = list[list.length - 1];
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      }
    }
    openers.forEach(btn => btn.addEventListener('click', openModal));
    scrim.addEventListener('click', closeModal);
    closeBtns.forEach(b => b.addEventListener('click', closeModal));
    tabSignin.addEventListener('click', () => activateTab('signin'));
    tabSignup.addEventListener('click', () => activateTab('signup'));

    // ---- Header UI swap (Sign in ↔ user) with right-anchored dropdown ----
    const authSlot = document.querySelector('.nav-auth');
    let closeAccountMenuHandler = null;

    function setSignedInUI(user) {
      // Clear current content of auth slot
      authSlot.replaceChildren();

      if (user) {
        // build dropdown
        const wrap = document.createElement('div');
        wrap.className = 'account';

        const trigger = document.createElement('button');
        trigger.type = 'button';
        trigger.className = 'btn small ghost account-btn';
        trigger.setAttribute('aria-haspopup', 'menu');
        trigger.setAttribute('aria-expanded', 'false');
        trigger.textContent = user.user_metadata?.name || user.email || 'Account';

        const menu = document.createElement('div');
        menu.className = 'account-menu';
        menu.setAttribute('role', 'menu');

        const signOut = document.createElement('button');
        signOut.type = 'button';
        signOut.className = 'item';
        signOut.setAttribute('role', 'menuitem');
        signOut.textContent = 'Sign out';
        signOut.addEventListener('click', async () => {
          await supabaseClient.auth.signOut();
          hideMenu();
        });

        menu.appendChild(signOut);
        wrap.appendChild(trigger);
        wrap.appendChild(menu);
        authSlot.appendChild(wrap);

        // menu logic
        function showMenu(){
          menu.classList.add('open');
          trigger.setAttribute('aria-expanded','true');
          document.addEventListener('click', outside, { capture:true });
          document.addEventListener('keydown', onKey);
          closeAccountMenuHandler = hideMenu;
        }
        function hideMenu(){
          menu.classList.remove('open');
          trigger.setAttribute('aria-expanded','false');
          document.removeEventListener('click', outside, { capture:true });
          document.removeEventListener('keydown', onKey);
          closeAccountMenuHandler = null;
        }
        function toggle(){ menu.classList.contains('open') ? hideMenu() : showMenu(); }
        function outside(e){ if (!wrap.contains(e.target)) hideMenu(); }
        function onKey(e){ if (e.key === 'Escape') { hideMenu(); trigger.focus(); } }

        trigger.addEventListener('click', toggle);
      } else {
        // Signed out → restore Sign in button in the right slot
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn small ghost js-open-auth';
        btn.textContent = 'Sign in';
        btn.addEventListener('click', openModal);
        authSlot.appendChild(btn);

        // close any leftover menu
        if (closeAccountMenuHandler) closeAccountMenuHandler();
      }
    }

    // ---- Auth handlers ----
    const siForm = document.getElementById('formSignIn');
    const suForm = document.getElementById('formSignUp');
    const siErr = document.getElementById('si-error');
    const suErr = document.getElementById('su-error');

    siForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      siErr.style.display = 'none';
      const email = document.getElementById('si-email').value.trim();
      const password = document.getElementById('si-pass').value;
      const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
      if (error) {
        siErr.textContent = error.message || 'Sign in failed';
        siErr.style.display = 'block';
        return;
      }
      closeModal();
    });

    suForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      suErr.style.display = 'none';
      const name = document.getElementById('su-name').value.trim();
      const email = document.getElementById('su-email').value.trim();
      const password = document.getElementById('su-pass').value;
      const { error } = await supabaseClient.auth.signUp({
        email, password,
        options: { data: { name } }
      });
      if (error) {
        suErr.textContent = error.message || 'Sign up failed';
        suErr.style.display = 'block';
        return;
      }
      closeModal();
    });

    document.getElementById('googleSignIn').addEventListener('click', () => {
      supabaseClient.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin }
      });
    });
    document.getElementById('googleSignUp').addEventListener('click', () => {
      supabaseClient.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin }
      });
    });

    // ---- Session / state ----
    (async () => {
      const { data: { session } } = await supabaseClient.auth.getSession();
      setSignedInUI(session?.user || null);
    })();

    supabaseClient.auth.onAuthStateChange((_event, session) => {
      setSignedInUI(session?.user || null);
    });

    // ---- Gate links to app.html (prevent immediate navigation if signed out) ----
    (function gateAppLinks(){
      async function onDocClick(e){
        const a = e.target.closest('a[href$="app.html"]');
        if (!a) return;

        // Allow new tab/window behaviors
        if (e.metaKey || e.ctrlKey || e.shiftKey || e.button === 1) return;

        // Block navigation FIRST
        e.preventDefault();

        const { data: { session } } = await supabaseClient.auth.getSession();
        if (session?.user) {
          window.location.href = a.href;
        } else {
          openModal();
        }
      }
      document.addEventListener('click', onDocClick, { capture: true });
    })();
  </script>
</body>
</html>
