<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pricing — Image to CSS</title>
  <meta name="description" content="Simple pricing for Image to CSS. Start free, upgrade when you need more."/>
  <link rel="stylesheet" href="style.css"/>
  <meta name="theme-color" content="#0f172a"/>

  <style>
    .pricing-hero{ padding:48px 0 24px; text-align:center; }
    .pricing-hero h1{ margin:8px 0; }
    .pricing-hero .lead{ max-width:720px; margin:0 auto; }

    .pricing-grid{
      display:grid; gap:24px;
      grid-template-columns: repeat(2, 1fr);
      margin: 18px auto 36px; max-width: var(--maxw); padding: 0 20px;
    }
    @media (max-width:800px){ .pricing-grid{ grid-template-columns:1fr; } }

    .price-card{
      background:var(--paper); border:1px solid var(--border);
      border-radius:var(--radius); box-shadow:var(--shadow);
      display:flex; flex-direction:column; overflow:hidden;
      opacity:0; transform: translateY(14px);
      animation: fadeUp .6s ease-out forwards;
    }
    .price-card:nth-child(1){ animation-delay:.05s; }
    .price-card:nth-child(2){ animation-delay:.15s; }

    .price-head{
      padding:18px; border-bottom:1px solid var(--border);
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
      background:#fbfbfc;
    }
    .plan-name{ font-weight:800; font-size:18px; margin:0; }
    .plan-tag{ font-size:12px; color:#0b3b4f; background:#e6f6fd; border:1px solid #c8e9f8; border-radius:999px; padding:4px 8px; font-weight:700; }

    .price{ display:flex; align-items:baseline; gap:6px; margin:0; font-weight:900; color:var(--ink); }
    .price .amount{ font-size:34px; line-height:1; }
    .price .per{ font-size:12px; color:var(--muted); }

    .price-body{ padding:16px; display:grid; gap:10px; }
    .feature{ display:flex; gap:10px; align-items:flex-start; color:var(--ink); }
    .feature .dot{ width:8px; height:8px; border-radius:999px; background:var(--accent); margin-top:7px; }
    .feature.off{ color:#9aa3af; }
    .feature .x{ width:16px; height:16px; margin-top:3px; display:inline-flex; align-items:center; justify-content:center; font-weight:900; color:#9aa3af; border:1px solid #e5e7eb; border-radius:4px; line-height:1; }

    .price-cta{ padding:16px; border-top:1px solid var(--border); background:#fff; display:grid; gap:8px; }
    .price-cta .btn{ width:100%; }

    .note{ text-align:center; color:var(--muted); font-size:12px; }

    /* Account dropdown (matches index/app) */
    .account { position: relative; }
    .account-menu{
      position:absolute; top:calc(100% + 6px); right:0;
      background:#fff; border:1px solid var(--border); border-radius:12px;
      padding:6px; min-width: 140px; box-shadow: var(--shadow);
      display:none;
    }
    .account-menu.open{ display:block; }
    .account-menu .item{
      display:block; width:100%; text-align:left;
      background:transparent; border:0; padding:10px 10px; border-radius:8px; cursor:pointer;
    }
    .account-menu .item:hover{ background:#f6f7f9; }

    /* Tiny focus ring when arriving via #pro */
    .price-card.focus { outline:2px solid var(--accent); outline-offset:2px; }

    /* ✅ missing before: run the entrance animation */
    @keyframes fadeUp { to { opacity:1; transform: translateY(0); } }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container nav">
      <a href="/" class="brand">
        <span class="brand-mark" aria-hidden="true"></span>
        <b>Image&nbsp;to&nbsp;CSS</b>
      </a>
      <nav class="links" aria-label="Primary">
        <div class="nav-center">
          <a href="pricing.html" aria-current="page">Pricing</a>
          <a href="app.html" class="btn small primary">Try it out</a>
        </div>
        <div class="nav-auth">
          <button class="btn small ghost js-open-auth" type="button">Sign in</button>
        </div>
      </nav>
    </div>
  </header>

  <main style="padding-bottom:40px">
    <section class="pricing-hero container">
      <span class="kicker"><span class="k-dot" aria-hidden="true"></span> Fair & simple pricing</span>
      <h1>Pick a plan, build faster</h1>
      <p class="lead">Start free. Upgrade when you want higher limits, cloud saves, and pro-grade exports.</p>
    </section>

    <section class="pricing-grid">
      <!-- Free -->
      <article class="price-card" id="plan-free">
        <header class="price-head">
          <h2 class="plan-name">Free</h2>
          <span class="plan-tag">Start here</span>
        </header>
        <div class="price-body">
          <p class="price"><span class="amount">$0</span><span class="per">/mo</span></p>

          <div class="feature"><span class="dot"></span><div>Access to AI Code Commenter</div></div>
          <div class="feature off"><span class="x">×</span><div>Local-only — nothing stored</div></div>
          <div class="feature off"><span class="x">×</span><div>Access to image → css</div></div>
          <div class="feature off"><span class="x">×</span><div>Higher limits (10MB), faster queue</div></div>
        </div>
        <div class="price-cta">
          <a href="app.html" class="btn block">Use Free</a>
        </div>
      </article>

      <!-- Pro -->
      <article class="price-card" id="plan-pro">
        <header class="price-head">
          <h2 class="plan-name">Pro</h2>
          <span class="plan-tag">Popular</span>
        </header>
        <div class="price-body">
          <p class="price"><span class="amount">$12</span><span class="per">/mo</span></p>
          <div class="feature"><span class="dot"></span><div>Access to Image &gt; CSS Generator</div></div>
          <div class="feature"><span class="dot"></span><div>Access to AI Code Commenter</div></div>
          <div class="feature"><span class="dot"></span><div>24/h Email Support</div></div>
          <div class="feature"><span class="dot"></span><div>Higher limits (10MB), faster queue</div></div>
        </div>
        <div class="price-cta">
          <button id="goPro" class="btn primary block" type="button">Go Pro</button>
          <button id="manageBilling" class="btn ghost block" type="button" style="display:none">Manage billing</button>
        </div>
      </article>
    </section>

    <p class="note container">Prices in USD. Cancel anytime. Taxes/VAT may apply.</p>
  </main>

  <footer class="footer">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;height:100%">
      <span>© <span id="y">2025</span> Image to CSS</span>
      <span style="color:var(--muted)">Private by default</span>
    </div>
  </footer>

  <!-- Supabase + header auth dropdown + Stripe wiring -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const SUPABASE_URL = "https://vsdmfjkhehtagsrvxbav.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzZG1mamtoZWh0YWdzcnZ4YmF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTA1NjksImV4cCI6MjA3MzM2NjU2OX0.Xd1VhsuOhJF1iEDaw1JApJ5JigJTODypjogm3hdrXxA";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true }
    });

    const authSlot = document.querySelector('.nav-auth');
    const goProBtn = document.getElementById('goPro');
    const manageBtn = document.getElementById('manageBilling');

    function setSignedInUI(user) {
      authSlot.replaceChildren();

      if (user) {
        // show Manage billing
        manageBtn.style.display = 'block';

        const wrap = document.createElement('div');
        wrap.className = 'account';

        const trigger = document.createElement('button');
        trigger.type = 'button';
        trigger.className = 'btn small ghost';
        trigger.textContent = user.user_metadata?.name || user.email || 'Account';
        trigger.setAttribute('aria-haspopup', 'menu');
        trigger.setAttribute('aria-expanded', 'false');

        const menu = document.createElement('div');
        menu.className = 'account-menu';
        menu.setAttribute('role', 'menu');

        const signOut = document.createElement('button');
        signOut.type = 'button';
        signOut.className = 'item';
        signOut.setAttribute('role','menuitem');
        signOut.textContent = 'Sign out';
        signOut.addEventListener('click', async () => {
          await supabaseClient.auth.signOut();
          hideMenu();
          manageBtn.style.display = 'none';
        });

        menu.appendChild(signOut);
        wrap.append(trigger, menu);
        authSlot.appendChild(wrap);

        function showMenu(){
          menu.classList.add('open');
          trigger.setAttribute('aria-expanded','true');
          document.addEventListener('click', outside, { capture:true });
          document.addEventListener('keydown', onKey);
        }
        function hideMenu(){
          menu.classList.remove('open');
          trigger.setAttribute('aria-expanded','false');
          document.removeEventListener('click', outside, { capture:true });
          document.removeEventListener('keydown', onKey);
        }
        function toggle(){ menu.classList.contains('open') ? hideMenu() : showMenu(); }
        function outside(e){ if (!wrap.contains(e.target)) hideMenu(); }
        function onKey(e){ if (e.key === 'Escape') { hideMenu(); trigger.focus(); } }
        trigger.addEventListener('click', toggle);

      } else {
        manageBtn.style.display = 'none';
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'btn small ghost js-open-auth';
        b.textContent = 'Sign in';
        authSlot.appendChild(b);
      }
    }

    (async () => {
      const { data: { session } } = await supabaseClient.auth.getSession();
      setSignedInUI(session?.user || null);
    })();
    supabaseClient.auth.onAuthStateChange((_e, s) => setSignedInUI(s?.user||null));

    // === Stripe actions ===
    goProBtn.addEventListener('click', async () => {
      const { data: { session} } = await supabaseClient.auth.getSession();
      const body = session?.user ? { email: session.user.email, userId: session.user.id } : {};
      goProBtn.disabled = true; goProBtn.textContent = 'Redirecting…';
      try {
        const r = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        const payload = await r.json();
        if (!r.ok) throw new Error(payload.error || 'Checkout init failed');
        window.location.href = payload.url;
      } catch (err) {
        alert(err.message || 'Unable to start checkout');
        goProBtn.disabled = false; goProBtn.textContent = 'Go Pro';
      }
    });

    manageBtn.addEventListener('click', async () => {
      const { data: { session } } = await supabaseClient.auth.getSession();
      if (!session?.user?.email) return alert('Sign in first');
      manageBtn.disabled = true; manageBtn.textContent = 'Opening…';
      try {
        const r = await fetch('/api/create-portal-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: session.user.email })
        });
        const payload = await r.json();
        if (!r.ok) throw new Error(payload.error || 'Could not open billing portal');
        window.location.href = payload.url;
      } catch (e) {
        alert(e.message || 'No billing profile found for this email.');
        manageBtn.disabled = false; manageBtn.textContent = 'Manage billing';
      }
    });

    // If they landed via #pro, scroll to the Pro card and add a brief focus ring
    if (location.hash.toLowerCase() === '#pro') {
      window.addEventListener('DOMContentLoaded', () => {
        const pro = document.getElementById('plan-pro');
        if (pro) {
          pro.classList.add('focus');
          pro.scrollIntoView({ behavior: 'smooth', block: 'center' });
          setTimeout(() => pro.classList.remove('focus'), 1600);
        }
      });
    }
  </script>
</body>
</html>
